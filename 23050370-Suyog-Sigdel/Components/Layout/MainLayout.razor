@using _23050370_Suyog_Sigdel.Services
@using Npgsql
@inherits LayoutComponentBase
@inject ThemeService ThemeService

<div class="main-layout @ThemeClass">
    <Navbar />
    <div class="content">
        @Body
    </div>
</div>

@code {
    private string ThemeClass => ThemeService.IsDark ? "dark" : "light";

    protected override void OnInitialized()
    {
        ThemeService.OnThemeChanged += StateHasChanged;
    }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var connectionString =
                "Host=db.lsyacsszkbmkgaoxdvgi.supabase.co;" +
                "Database=postgres;" +
                "Username=postgres;" +
                "Password=20132005;" +
                "SSL Mode=Require;Trust Server Certificate=true;Timeout=10;";

            using var conn = new NpgsqlConnection(connectionString);
            await conn.OpenAsync();
            Console.WriteLine("✅ Connected to Supabase successfully!");
            await conn.CloseAsync();
        }
        catch (Exception ex)
        {
            Console.WriteLine("❌ Database connection failed:");
            Console.WriteLine(ex.Message);
        }
    }
}