@* RichTextEditor.razor *@
@inject IJSRuntime JSRuntime

<div class="rte-wrapper">
    <div class="rte-toolbar">
        <button type="button" @onclick="MakeBold" class="toolbar-btn" title="Bold">
            <i class="fa fa-bold"></i>
        </button>
        <button type="button" @onclick="MakeItalic" class="toolbar-btn" title="Italic">
            <i class="fa fa-italic"></i>
        </button>
        <button type="button" @onclick="MakeUnderline" class="toolbar-btn" title="Underline">
            <i class="fa fa-underline"></i>
        </button>
        <div class="toolbar-divider"></div>
        <button type="button" @onclick="MakeBulletList" class="toolbar-btn" title="Bullet List">
            <i class="fa fa-list-ul"></i>
        </button>
        <button type="button" @onclick="MakeNumberList" class="toolbar-btn" title="Numbered List">
            <i class="fa fa-list-ol"></i>
        </button>
    </div>
    
    <div @ref="editorElement" 
         class="rte-editor" 
         contenteditable="true"
         @oninput="HandleInput"
         placeholder="Write your journal entry here...">
    </div>
</div>

@code {
    private ElementReference editorElement;
    private string htmlContent = string.Empty;

    [Parameter]
    public EventCallback<string> OnContentChanged { get; set; }

    private async Task MakeBold()
    {
        await JSRuntime.InvokeVoidAsync("eval", "document.execCommand('bold', false, null)");
    }

    private async Task MakeItalic()
    {
        await JSRuntime.InvokeVoidAsync("eval", "document.execCommand('italic', false, null)");
    }

    private async Task MakeUnderline()
    {
        await JSRuntime.InvokeVoidAsync("eval", "document.execCommand('underline', false, null)");
    }

    private async Task MakeBulletList()
    {
        await JSRuntime.InvokeVoidAsync("eval", "document.execCommand('insertUnorderedList', false, null)");
    }

    private async Task MakeNumberList()
    {
        await JSRuntime.InvokeVoidAsync("eval", "document.execCommand('insertOrderedList', false, null)");
    }

    private async Task HandleInput()
    {
        try
        {
            htmlContent = await JSRuntime.InvokeAsync<string>("eval", "document.querySelector('.rte-editor').innerHTML");
            await OnContentChanged.InvokeAsync(htmlContent);
        }
        catch
        {
            // Ignore errors during input
        }
    }

    public async Task<string> GetHTML()
    {
        try
        {
            htmlContent = await JSRuntime.InvokeAsync<string>("eval", "document.querySelector('.rte-editor').innerHTML");
            return htmlContent;
        }
        catch
        {
            return htmlContent;
        }
    }

    public async Task LoadHTMLContent(string html)
    {
        htmlContent = html ?? string.Empty;
        try
        {
            await JSRuntime.InvokeVoidAsync("eval", $"document.querySelector('.rte-editor').innerHTML = `{htmlContent}`");
        }
        catch
        {
            // Ignore if element not ready
        }
    }

    public async Task Clear()
    {
        await LoadHTMLContent(string.Empty);
    }
}